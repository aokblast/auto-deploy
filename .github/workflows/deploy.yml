name: "Deploy on main branch changes"

on:
  push:
    branches:
      - main
      - testing
    paths:
      - inventory/**
      - ./.github/workflows/base-template.yml
      - base-setup.yml
      - templates/dotfiles.yml
      - bootstrap-runner.yml

jobs:
  base-public:
    uses: ./.github/workflows/base-template.yml
    with:
      limits: 'all:!A'
      host_labels: ubuntu-latest   # optional, e.g., for self-hosted runner
    secrets: inherit

  base-homelab:
    uses: ./.github/workflows/base-template.yml
    with:
      limits: 'A'
      host_labels: homelab   # optional, e.g., for self-hosted runner
    secrets: inherit